<!--
/*
 * Copyright 2012 The Toolkitchen Authors. All rights reserved.
 * Use of this source code is governed by a BSD-style
 * license that can be found in the LICENSE file.
 */
-->
<element name="pi-accounts-model">
  <script>
    var DEFAULT_TOPICS = [
      {title: 'Technology', feed: ['http://www.theverge.com/rss/index.xml', 'http://feeds.engadget.com/weblogsinc/engadget']},
      {title: 'Rock Paper Shotgun', feed: 'http://feeds.feedburner.com/RockPaperShotgun'},
      {title: 'The Kitchn', feed: 'http://feeds.thekitchn.com/apartmenttherapy/thekitchn'},
      {title: 'Engadget', feed: 'http://feeds.engadget.com/weblogsinc/engadget'},
      {title: 'Deadspin', feed: 'http://feeds.gawker.com/deadspin/full'},
      {title: 'The Big Picture', feed: 'http://www.boston.com/bigpicture/index.xml'},
      {title: 'Design Milk', feed: 'http://feeds.feedburner.com/design-milk'},
      {title: 'The Verge', feed: 'http://www.theverge.com/rss/index.xml'},
      {title: 'Cute Overload', feed: 'http://cuteoverload.com/feed/'},
      {title: 'MAKE', feed: 'http://blog.makezine.com/index.xml'},
      {title: 'PopSugar', feed: 'http://www.popsugar.com/posts/feed'},
      {title: 'indie shuffle', feed: 'http://feeds.feedburner.com/indieshuffle'},
      {title: 'Create Digital Music', feed: 'http://createdigitalmusic.com/feed/'},
      {title: 'Doodlers Anonymous', feed: 'http://feeds.feedburner.com/DoodlersAnonymous'}
    ];
    
    var DEFAULT_STOCKS = ['GOOG', 'AAPL'];
    
    var ACCOUNTS_STORAGE_NAME = 'pica-accounts';
    
    this.component({
      publish: {
        topics: null,
        stocks: null,
        addTopic: function(inTopic) {
          this.addItem(this.topics, inTopic);
        },
        removeTopic: function(inTopic) {
          this.removeItem(this.topics, inTopic);
        },
        addStock: function(inStock) {
          this.addItem(this.stocks, inStock);
        },
        removeStock: function(inStock) {
          this.removeItem(this.stocks, inStock);
        },
        reset: function() {
          this.topics = DEFAULT_TOPICS.slice(0);
          this.stocks = DEFAULT_STOCKS.slice(0);
          this.save();
        }
      },
      ready: function() {
        this.load();
      },
      addItem: function(inItems, inItem) {
        inItems.push(inItem);
        this.save();
      },
      removeItem: function(inItems, inItem) {
        var i = inItems.indexOf(inItem);
        if (i >= 0) {
          inItems.splice(i, 1);
        }
        this.save();
      },
      load: function() {
        var s = window.localStorage.getItem(ACCOUNTS_STORAGE_NAME);
        if (s) {
          var a = JSON.parse(s);
          this.topics = a.topics;
          this.stocks = a.stocks;
        } else {
          this.topics = DEFAULT_TOPICS.slice(0);
          this.stocks = DEFAULT_STOCKS.slice(0);
        }
      },
      save: function() {
        window.localStorage.setItem(ACCOUNTS_STORAGE_NAME, JSON.stringify({topics: this.topics, stocks: this.stocks}));
        // force to mutate topics to trigger property changed (e.g. itemsChanged in pi-items-view)
        this.topics = this.topics.slice(0);
      }
    });
  </script>
</element>
