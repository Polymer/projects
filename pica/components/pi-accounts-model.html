<!--
/*
 * Copyright 2012 The Toolkitchen Authors. All rights reserved.
 * Use of this source code is governed by a BSD-style
 * license that can be found in the LICENSE file.
 */
-->
<element name="pi-accounts-model">
  <script>
    var DEFAULT_TOPICS = [
      {title: 'Technology', imgSrc: 'http://www.google.com/about/company/images/company-products.png', feed: ['http://www.theverge.com/rss/index.xml', 'http://feeds.engadget.com/weblogsinc/engadget']},
      {title: 'The Verge', imgSrc: 'https://lh3.ggpht.com/NAigEH6J985CuPR2r71cJ6C5mr1JGShoyFOjKAh_vV7Chxx8zsMOIwdKyS89xsJ77w=w705', feed: 'http://www.theverge.com/rss/index.xml'},
      {title: 'Rock Paper Shotgun', imgSrc: 'http://www.rockpapershotgun.com/images/09/nov/RPSUnityLogo.jpg', feed: 'http://feeds.feedburner.com/RockPaperShotgun'},
      {title: 'Engadget', imgSrc: 'http://www.engadget.com/common/images/4844163528551596.jpg.39721570957757146', feed: 'http://feeds.engadget.com/weblogsinc/engadget'},
      {title: 'The Kitchn', imgSrc: 'http://assets.hellocotton.com/avatars/square-256-911-12b30c1b425ea51d0b6ae70c8eae8346.png', feed: 'http://feeds.thekitchn.com/apartmenttherapy/thekitchn'},
      {title: 'Deadspin', imgSrc: 'http://ganja.gawkerassets.com/assets/v10.deadspin.com/img/logo-deadspin.png', feed: 'http://feeds.gawker.com/deadspin/full'},
      {title: 'The Big Picture', imgSrc: 'http://cache.boston.com/universal/site_graphics/blogs/bigpicture/big_picture_header.jpg', feed: 'http://www.boston.com/bigpicture/index.xml'},
      {title: 'Design Milk', imgSrc: 'http://3.design-milk.com/wp-content/themes/designmilk/images/DMLogoTM.png', feed: 'http://feeds.feedburner.com/design-milk'},
      {title: 'Cute Overload', imgSrc: 'http://upload.wikimedia.org/wikipedia/en/b/b4/Cute_overload_logo.jpg', feed: 'http://cuteoverload.com/feed/'},
      {title: 'MAKE', imgSrc: 'http://makezine.com/images/logos/makeLogo_url.gif', feed: 'http://blog.makezine.com/index.xml'},
      {title: 'PopSugar', imgSrc: 'http://media4.onsugar.com/v1708/themes/onsugar_themes/sugar2010/imgs/logos/popsugar.png', feed: 'http://www.popsugar.com/posts/feed'},
      {title: 'indie shuffle', imgSrc: 'http://www.google.com/reader/ui/2562708335-newspaper-icon.png', feed: 'http://feeds.feedburner.com/indieshuffle'},
      {title: 'Create Digital Music', imgSrc: 'http://www.google.com/reader/ui/2562708335-newspaper-icon.png', feed: 'http://createdigitalmusic.com/feed/'},
      {title: 'Doodlers Anonymous', imgSrc: 'http://www.google.com/reader/ui/2562708335-newspaper-icon.png', feed: 'http://feeds.feedburner.com/DoodlersAnonymous'}
    ];
    
    var DEFAULT_STOCKS = ['GOOG', 'AAPL'];
    
    var ACCOUNTS_STORAGE_NAME = 'pica-accounts';
    
    var DEFAULT_TOPIC_IMG_SRC = 'http://www.google.com/reader/ui/2562708335-newspaper-icon.png';
    
    this.component({
      publish: {
        topics: null,
        stocks: null,
        addTopic: function(inTopic) {
          if (!inTopic.imgSrc) {
            inTopic.imgSrc = DEFAULT_TOPIC_IMG_SRC;
          }
          this.addItem(this.topics, inTopic);
        },
        removeTopic: function(inTopic) {
          this.removeItem(this.topics, inTopic);
        },
        addStock: function(inStock) {
          this.addItem(this.stocks, inStock);
        },
        removeStock: function(inStock) {
          this.removeItem(this.stocks, inStock);
        },
        reset: function() {
          this.topics = DEFAULT_TOPICS.slice(0);
          this.stocks = DEFAULT_STOCKS.slice(0);
          this.save();
        }
      },
      ready: function() {
        this.load();
      },
      addItem: function(inItems, inItem) {
        inItems.push(inItem);
        this.save();
      },
      removeItem: function(inItems, inItem) {
        var i = inItems.indexOf(inItem);
        if (i >= 0) {
          inItems.splice(i, 1);
        }
        this.save();
      },
      load: function() {
        var s = window.localStorage.getItem(ACCOUNTS_STORAGE_NAME);
        if (s) {
          var a = JSON.parse(s);
          this.topics = a.topics;
          this.stocks = a.stocks;
        } else {
          this.topics = DEFAULT_TOPICS.slice(0);
          this.stocks = DEFAULT_STOCKS.slice(0);
        }
      },
      save: function() {
        window.localStorage.setItem(ACCOUNTS_STORAGE_NAME, JSON.stringify({topics: this.topics, stocks: this.stocks}));
        // force to mutate topics to trigger property changed (e.g. itemsChanged in pi-items-view)
        this.topics = this.topics.slice(0);
      }
    });
  </script>
</element>
