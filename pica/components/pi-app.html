<!--
/*
 * Copyright 2012 The Toolkitchen Authors. All rights reserved.
 * Use of this source code is governed by a BSD-style
 * license that can be found in the LICENSE file.
 */
-->
<element name="pi-app">
  <link rel="stylesheet" href="css/pi-app.css" />
  <link rel="components" href="../../../toolkit/src/g-component.html">
  <link rel="components" href="../../../toolkit/src/g-panels.html"/>
  <link rel="components" href="../../../toolkit/src/g-icon-button.html"/>
  <link rel="components" href="../../../toolkit/src/g-menu-item.html"/>
  <link rel="components" href="../../../toolkit/src/g-menu-button.html"/>
  <link rel="components" href="../../../toolkit/src/g-toolbar.html"/>
  <link rel="components" href="pi-ribbon.html"/>
  <link rel="components" href="pi-feed-viewer.html"/>
  <link rel="components" href="pi-accounts.html"/>
  <template>
    <g-panels id="panels" selected="{{selectedPanel}}" transition="flow">
      <pi-ribbon id="ribbon" label="Pica" selected="{{ribbonSelected}}" on-select="ribbonSelect">
        <g-menu-item name="topics" label="Topics" src="../images/ribbon_topics.svg"></g-menu-item>
        <g-menu-item name="accounts" label="Accounts" src="../images/ribbon_accounts.svg"></g-menu-item>
      </pi-ribbon>
      <div id="main">
        <g-toolbar>
          <g-icon-button id="navButton" src="../images/nav-list.svg" on-click="navButtonClick"></g-icon-button>
          <label class="flex">{{toolbarTitle}}</label>
          <g-toolbar class="responsive">
            <g-menu-button src="../images/view_quilt.svg" selected="{{layout}}" on-select="layoutSelect">
              <g-menu-item name="grid" label="Grid" src="../images/view_modules.svg"></g-menu-item>
              <g-menu-item name="quilt" label="Quilt" src="../images/view_quilt.svg"></g-menu-item>
            </g-menu-button>
            <g-menu-button src="../images/add.svg">
              <g-menu-item src="../images/edit_page.svg">Post a Comment</g-menu-item>
              <g-menu-item src="../images/chat.svg">Share Link</g-menu-item>
              <g-menu-item src="../images/email.svg">Email Link</g-menu-item>
              <g-menu-item src="../images/favorite.svg">Add to Favorites</g-menu-item>
            </g-menu-button>
            <g-icon-button src="../images/search_the_web.svg"></g-icon-button>
          </g-toolbar>
          <g-icon-button id="sourceButton" src="../images/source.svg" on-click="toggleSource"></g-icon-button>
        </g-toolbar>
        <g-panels id="contentPanels" selected="{{ribbonSelected}}">
          <pi-feed-viewer id="topics" selected="{{topicsSelectedPanel}}" layout="{{layout}}"></pi-feed-viewer>
          <pi-accounts id="accounts"></pi-accounts>
        </g-panels>
      </div>
      <div id="source" class="right" on-click="toggleSource"></div>
    </g-panels>
  </template>
  <script>
    this.component({
      ribbonSelected: 'topics',
      layout: 'grid',
      selectedPanel: 'main',
      topicsSelectedPanel: 'topics',
      navButtonClick: function() {
        if (this.topicsSelectedPanel == 'topics') {
          this.toggleNav();
        } else {
          this.$.topics.previous();
        }
      },
      toggleNav: function(inSelected) {
        if (inSelected) {
          this.selectedPanel = inSelected;
        } else {
          this.$.panels.toggleBetween('ribbon', 'main');
        }
        this.$.navButton.active = this.selectedPanel == 'ribbon';
      },
      toggleSource: function() {
        this.$.panels.toggleBetween('main', 'source');
        this.$.sourceButton.active = this.selectedPanel == 'source';
      },
      ribbonSelect: function() {
        var item = this.$.ribbon.selection;
        if (item) {
          this.toolbarTitle = item.label;
          // force to mutate topics to trigger itemsChanged in pi-items-view
          this.$.topics.topics = this.$.accounts.topics.slice(0);
          this.toggleNav('main');
        }
      },
      topicsSelectedPanelChanged: function() {
        this.$.navButton.src = 'images/' + 
          (this.topicsSelectedPanel == 'topics' ? 'nav-list.svg' : 'nav-return.svg');
        this.toggleNav('main');
      }
    });
  </script>
</element>
