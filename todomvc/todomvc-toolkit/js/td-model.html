<element name="td-model" attributes="filter items">
  <script>
    Polymer.register(this, {
      items: [],
      itemsMap: {},
      filter: '',
      filtered: null,
      completedCount: 0,
      activeCount: 0,
      filterChanged: function() {
        this.filterItems();
      },
      itemsChanged: function() {
        this.completedCount =
          this.items.filter(this.filters.completed).length;
        this.activeCount = this.items.length - this.completedCount;
        //console.warn("setting activeCount: ", this.activeCount);
        this.filterItems();
      },
      filterItems: function() {
        var fn = this.filters[this.filter];
        this.filtered = fn ? this.items.filter(fn) : this.items;
      },
      newItem: function(title) {
        title = String(title).trim();
        if (title) {
          var item = {
            id: Math.random(),
            title: title,
            completed: false
          };
          this.items.push(item);
          this.itemsMap[item.id] = item;
          this.itemsChanged();
        }
      },
      destroyItem: function(id) {
        var item = this.itemsMap[id];
        if (item) {
          var i = this.items.indexOf(item);
          if (i >= 0) {
            this.items.splice(i, 1);
          }
          delete this.itemsMap[id];
          this.itemsChanged();
        }
      },
      clearItems: function(){
        this.itemsMap = {};
        this.items = this.items.filter(this.filters.active);
        this.items.forEach(function(item) {
          this.itemsMap[item.id] = item;
        }.bind(this));
      },
      filters: {
        active: function(item) {
          return !item.completed;
        },
        completed: function(item) {
          return item.completed;
        }
      }
   });
  </script>
</element>
