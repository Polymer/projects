<!--
/*
 * Copyright 2013 The Polymer Authors. All rights reserved.
 * Use of this source code is governed by a BSD-style
 * license that can be found in the LICENSE file.
 */
-->
<link rel="import" href="../../../more-elements/Ace/Ace.html">
<link rel="import" href="pg-output.html">

<element name="pg-app">
  <link rel="stylesheet" href="css/pg-app.css" />
  <template>
    <polymer-flex-layout></polymer-flex-layout>
    <polymer-ui-sidebar-menu id="menu" label="Playground" selectedModel="{{selectedElement}}">
      <template repeat="{{elements}}">
        <polymer-ui-menu-item label="{{label}}"></polymer-ui-menu-item>
      </template>
    </polymer-ui-sidebar-menu>
    <div flex>
      <polymer-flex-layout vertical></polymer-flex-layout>
      <polymer-ui-toolbar>
        <button class="toolbar-button" on-tap="run">Run</button>
        <div flex></div>
      </polymer-ui-toolbar>
      <div flex>
        <polymer-flex-layout></polymer-flex-layout>
        <ajaxorg-ace id="ace" mode="html" theme="chrome" tabSize="2" class="{{minimized: maximized}}"></ajaxorg-ace>
        <div flex>
          <polymer-flex-layout vertical></polymer-flex-layout>
          <polymer-ui-toolbar theme="polymer-ui-light-theme">
            <polymer-ui-icon-button src="{{arrowImageSrc}}" on-tap="toggleMaximized"></polymer-ui-icon-button>
            <div>Output</div>
          </polymer-ui-toolbar>
          <pg-output flex value="{{source}}"></pg-output>
        </div>
      </div>
    </div>
    <polymer-meta list="{{elements}}"></polymer-meta>
  </template>
  <script>
    Polymer.register(this, {
      maximized: false,
      ready: function() {
        this.asyncMethod(function() {
          this.$.menu.selected = this.elements[0].label;
        });
        this.maximizedChanged();
      },
      toggleMaximized: function() {
        this.maximized = !this.maximized;
      },
      maximizedChanged: function() {
        this.arrowImageSrc = this.resolvePath('images/arrow_' + 
            (this.maximized ? 'right' : 'left')  + '.png');
      },
      selectedElementChanged: function() {
        var s = this.selectedElement.archetype.innerHTML.trim();
        // remove extra spaces in the beginning of each line
        this.$.ace.value = s.replace(/^[\s]{0,4}/gm, '');
        this.asyncMethod('run');
      },
      run: function() {
        this.source = this.$.ace.editor.getValue();
      }
    });
  </script>
</element>