<element name="tk-meta" attributes="label isContainer isHidden list">
  <script>
    var metaData = {}, metaArray = [];
    Toolkit.register(this, {
      isContainer: false,
      isHidden: false,
      ready: function() {
        this.idChanged();
        this.updateProperties();
      },
      idChanged: function(inOld) {
        if (this.id && this.id !== 'meta') {
          metaData[this.id] = this;
          metaArray.push(this);
        }
      },
      get list() {
        return metaArray;
      },
      get archetype() {
        return this.querySelector('template');
      },
      byId: function(id) {
        return metaData[id];
      },
      updateProperties: function() {
        var props = {};
        var ps = this.querySelectorAll('property');
        ps && Array.prototype.forEach.call(ps, function(p) {
          var o = {};
          forEach(p.attributes, function(a) {
            var v = a.value;
            v = v.indexOf(',') > 0 ? v.split(',') : v;
            o[a.name] = v;
          });
          props[o.name] = o;
        });
        this.properties = props;
      },
      createElement: function() {
        if (this.archetype) {
          return this.archetype.createInstance().querySelector('*');
        } else {
          return document.createElement(this.id);
        }
      }
    });
  </script>
</element>
