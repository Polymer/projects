<!--
Copyright 2013 The Toolkitchen Authors. All rights reserved.
Use of this source code is governed by a BSD-style
license that can be found in the LICENSE file.
-->
<element name="tk-tree" attributes="element">
  <template>
    <style>
      #interior {
        border: 1px dotted gray;
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        padding: 8px;
        overflow-x: hidden;
        overflow-y: auto;
      }
      b {
        color: blue;
      }
      id {
        font-style: italic;
        color: #804C00;
      }
    </style>
    <div id="interior">
      <strong>Components</strong>
      <hr/>
      <template repeat="{{components}}">
        <div style="padding-left: {{indent}}px"><b>{{name}}</b><id>{{id}}</id>{{text}}</div>
      </template>
    </div>
  </template>
  <script>
    Toolkit.register(this, {
      components: null,
      update: function() {
        var tabsize = 32;
        var components = this.components = [];
        function subtree(root, indent) {
          var e = root.firstElementChild;
          while (e) {
            var text = e.children.length == 0 ? e.textContent.trim() : '';
            if (text) {
              if (text.length > 12) {
                text = text.slice(0, 12) + "...";
              }
              text = ' "' + text + '"';
            }
            components.push({
              indent: indent,
              name: e.localName,
              id: e.id ? ' #' + e.id + '': '',
              text: text
            });
            subtree(e, indent + tabsize);
            e = e.nextElementSibling;
          }
        }
        subtree(this.element, 0);
      }
    });
  </script>
</element>
