<!--
Copyright 2013 The Toolkitchen Authors. All rights reserved.
Use of this source code is governed by a BSD-style
license that can be found in the LICENSE file.
-->
<element name="tk-tree" attributes="element selected">
  <template>
    <style>
      #title {
        font-size: 16px;
        padding: 8px 0 14px;
        border-bottom: 1px solid silver;
        margin-bottom: 4px;
      }
      #interior {
        border: 1px dotted gray;
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        padding: 8px;
        overflow-x: hidden;
        overflow-y: auto;
        cursor: pointer;
      }
      b {
        color: blue;
      }
      id {
        font-style: italic;
        color: #804C00;
      }
      #tree {
        display: inline-block;
      }
      .selected span {
        background: lightblue;
      }
    </style>
    <div id="interior" touch-action="none" on-tap="tap">
      <div id="title">Components</div>
      <div id="tree">
        <template repeat="{{components}}">
          <div class="{{selected}}" style="padding-left: {{indent}}px"><span><b>{{name}}</b><id>{{id}}</id>{{text}}</span></div>
        </template>
      </div>
    </div>
  </template>
  <script>
    Toolkit.register(this, {
      components: null,
      update: function() {
        var selected = this.selected;
        var tabsize = 32;
        var components = this.components = [];
        function subtree(root, indent) {
          var e = root.firstElementChild;
          while (e) {
            var text = e.children.length == 0 ? e.textContent.trim() : '';
            if (text) {
              if (text.length > 12) {
                text = text.slice(0, 12) + "...";
              }
              text = ' "' + text + '"';
            }
            components.push({
              indent: indent,
              name: e.localName,
              element: e,
              id: e.id ? ' #' + e.id + '': '',
              text: text,
              selected: (e == selected) ? 'selected' : ''
            });
            subtree(e, indent + tabsize);
            e = e.nextElementSibling;
          }
        }
        subtree(this.element, 0);
      },
      tap: function(e) {
        var nodes = this.$.tree.children;
        var selected = nodes[Toolkit.findDistributedTarget(e.target, nodes)];
        if (selected) {
          this.selected = selected.templateInstance.model.element;
        }
      }
    });
  </script>
</element>
