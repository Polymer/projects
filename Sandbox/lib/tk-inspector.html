<!--
Copyright 2013 The Toolkitchen Authors. All rights reserved.
Use of this source code is governed by a BSD-style
license that can be found in the LICENSE file.
-->
<script src="reflection.js"></script>

<element name="tk-inspector" attributes="element">
  <template>
    <style>
      @host {
        * {
          border: 1px solid silver;
        }
      }
      #header {
        background-color: #E0E0E0;
        border-bottom: 1px solid silver;
        padding-top: 4px;
        height: 44px;
        /*line-height: 60px;*/
      }
      #interior {
        position: absolute;
        top: 62px;
        right: 0;
        bottom: 0;
        left: 0;
        padding: 8px;
        overflow-x: hidden;
        overflow-y: auto;
      }
      g-icon-button {
        vertical-align: middle;
      }
    </style>
      <div id="header">
        <g-icon-button src="assets/ic_chevron_left_darkreg.png" on-click="selectParentElement"></g-icon-button>
        <b>{{name}}</b>
        <g-icon-button src="assets/ic_delete_darkreg.png" on-click="deleteElement" style="float: right"></g-icon-button>
      </div>
      <div id="interior">
        <template repeat="{{properties}}">
          <tk-property-editor property="{{}}"></tk-property-editor>
        </template>
        <tk-style-inspector element="{{element}}"></tk-style-inspector>
      </div>
    </div>
  </template>
  <script>
    Toolkit.register(this, {
      element: null,
      properties: null,
      name: '',
      elementChanged: function() {
        this.properties = Reflection.properties(this.element);
        this.name = this.element && this.element.localName || '';
      },
      deleteElement: function() {
        this.send('delete-element');
      },
      selectParentElement: function() {
        this.send('parent-element');
      }
    });
  </script>
</element>

<element name="tk-style-inspector" attributes="element">
  <template>
    <template repeat="{{properties}}">
      <tk-property-editor property="{{}}"></tk-property-editor>
    </template>
    <tk-meta id="meta">
      <property name="backgroundColor" kind="color"></property>
      <property name="opacity" kind="range" min="0" max="1" step="0.1" defaultvalue="1"></property>
      <property name="border"></property>
      <property name="width"></property>
      <property name="height"></property>
      <property name="test" kind="tk-compound-editor"></property>
    </tk-meta>
  </template>
  <script>
    Toolkit.register(this, {
      properties: null,
      elementChanged: function() {
        this.properties = Reflection.styles(this.element, this.$.meta.properties);
      }
    });
  </script>
</element>

<element name="tk-property-editor" attributes="property">
  <template>
    <style>
      @host {
        *{
          display: block;
          white-space: nowrap;
          margin-bottom: 12px;
        }
      }
      .property-name {
        text-overflow: ellipsis;
        overflow: hidden;
        color: #949494;
        font-size: 0.9rem;
        font-weight: bold;
        margin-bottom: 8px;
      }
      #container {
        display: inline-block;
        width: 92%;
      }
    </style>
    <div class="property-name">{{property.name}}:</div>
    <div id="container"><content></content><tk-string-editor id="binder" hidden></tk-string-editor></div><g-icon src="assets/link.png" size="16" on-click="linkTap"></g-icon>
    <g-flip id="flip" targetSelector="#container" on-complete="flipComplete"></g-flip>
  </template>
  <script>
    Toolkit.register(this, {
      property: null,
      editor: null,
      bound: null,
      editorTypes: {
        'boolean': 'tk-boolean-editor',
        'string': 'tk-string-editor',
        'select': 'tk-select-editor',
        'color': 'tk-color-editor',
        'text': 'tk-text-editor',
        'id-select': 'tk-id-select-editor',
        'target-select': 'tk-target-select-editor',
        'speech': 'tk-speech-editor',
        'range': 'tk-range-editor',
        any: 'tk-string-editor'
      },
      ready: function() {
        this.bound = false;
      },
      propertyChanged: function() {
        var m = this.property.meta;
        var type = this.editorTypes[m && m.kind || typeof this.property.value] || (m && m.kind);
        this.editor = document.createElement(type || this.editorTypes.any);
        this.editor.property = this.property;
      },
      editorChanged: function(inOld) {
        if (inOld) {
          inOld.parentNode.removeChild(inOld);
        }
        this.appendChild(this.editor);
        //this.$.flip.target = this.editor;
        //this.$.flip.targetSelector = ".property-name";
      },
      linkTap: function() {
        this.$.flip.play();
      },
      flipComplete: function() {
        this.bound = !this.bound;
      },
      boundChanged: function() {
        this.editor.style.display = this.bound ? 'none' : null;
        this.$.binder.style.display = !this.bound ? 'none' : null;
      }
    });
  </script>
</element>
